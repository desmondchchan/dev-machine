- name: Install  Homebrew
  vars:
    install_homebrew_if_missing: true
  block:
    - name: Install Homebrew
      tags:
        - brew
      block:
        - name: Ensuring Homebrew Is Installed
          stat:
            path: /home/linuxbrew/.linuxbrew/bin/brew
          register: homebrew_check
        - name: Fail If Homebrew Is Not Installed and install_homebrew_if_missing Is False
          fail:
            msg: Homebrew is missing, install from http://brew.sh
          when:
            - not homebrew_check.stat.exists
            - not install_homebrew_if_missing
        - name: Install Homebrew
          shell: |
            yes | /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
            (echo; echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"') >> ~/.bashrc
          when:
            - not homebrew_check.stat.exists
            - install_homebrew_if_missing
